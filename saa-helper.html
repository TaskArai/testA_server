<!DOCTYPE html>
<html lang="ja">
<head><meta charset="UTF-8"><title>SAA Helper</title></head>
<body style="margin:0; padding:0;">
    <button id="saa-trigger-btn" style="width:100%; height:100%; border:1px solid #ccc; background:#f0f0f0; cursor:pointer;">情報を取得</button>
    <script>
      document.getElementById('saa-trigger-btn').addEventListener('click', async function() {
        try {
          await document.requestStorageAccess();
          var cookieName = '_atb_poc_data';
          var atbCookie = document.cookie.match(new RegExp('(^| )' + cookieName + '=([^;]+)')) || [];
          var atbDataString = atbCookie.length > 2 ? decodeURIComponent(atbCookie[2]) : null;
          
          if (atbDataString) {
            window.parent.postMessage({
              type: 'atb_data_ready',
              data: JSON.parse(atbDataString)
            }, 'https://taskaraitest.github.io');
            this.innerText = '送信成功!';
            this.style.background = '#d4edda';
          } else {
            console.log('Cookieは見つかりましたが、中身が空でした。');
            this.innerText = 'データ無';
          }
        } catch (error) { 
          // ★★★ エラーをコンソールに表示する処理を追加 ★★★
          console.error('SAAボタンのクリックでエラーが発生しました:', error);
          this.innerText = 'エラー'; 
        }
      });
    </script>
</body>
</html>
